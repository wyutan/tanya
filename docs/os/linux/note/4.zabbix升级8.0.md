:::warning
zabbix8.0支持的MySQL最低版本为8.04.00
:::
:::info
zabbix7.4.0升级至8.0
数据库：mysql8.0.41升级至8.4.8
web服务器：apache
系统：RHEL8.7
mysql本地升级，mysql安装包下载请点击mysql communityhttps://dev.mysql.com/downloads/mysql/
:::
## 升级mysql
### 停止服务
```
systemctl stop zabbix-server
systemctl stop mysqld
```
### 备份数据库
```
tar -cvf /root/mysql_data_bak_$(date +%F).tar /var/lib/mysql
```
### 卸载旧mysql安装包
==由于升级过程中出现对同一个文件的“所有权”冲突，故直接卸载旧安装包，不影响`/var/lib/mysql/`中的数据库文件=={.tip}
```
dnf remove mysql mysql-server mysql-common mysql-errmsg -y
```
### 安装mysql
```
yum localinstall mysql-community-client-8.4.8-1.el8.x86_64.rpm mysql-community-client-plugins-8.4.8-1.el8.x86_64.rpm  mysql-community-common-8.4.8-1.el8.x86_64.rpm mysql-community-icu-data-files-8.4.8-1.el8.x86_64.rpm  mysql-community-libs-8.4.8-1.el8.x86_64.rpm
```
### 启动并验证
- 启动mysql服务
```
systemctl start mysqld
```
- 检查版本
```
mysql -V
```
## 升级zabbix
### 停止服务
```
systemctl stop zabbix-server
systemctl stop zabbix-proxy
systemctl stop zabbix-agent
```
### 备份配置文件及数据库
- 备份配置文件
```
mkdir /opt/zabbix-backup/
cp /etc/zabbix/zabbix_server.conf /opt/zabbix-backup/
cp /etc/httpd/conf.d/zabbix.conf  /opt/zabbix-backup/
```
- 备份PHP 文件和 Zabbix 二进制文件
```
cp -R /usr/share/zabbix/ /opt/zabbix-backup/
cp -R /usr/share/zabbix-* /opt/zabbix-backup/
```
### 更新存储库配置包
```
rpm -Uvh https://repo.zabbix.com/zabbix/8.0/release/rhel/9/noarch/zabbix-release-latest.el9.noarch.rpm
```
- 清理缓存
```
dnf clean all
```
### 升级zabbix组件
```
dnf install zabbix-server-mysql zabbix-web-mysql zabbix-apache-conf zabbix-sql-scripts zabbix-selinux-policy zabbix-agent
```
### 启动进程
```
systemctl restart httpd
systemctl start zabbix-server
systemctl start zabbix-proxy
systemctl start zabbix-agent
```
