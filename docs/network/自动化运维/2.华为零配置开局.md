==在零配置设备部署场景中，如果用户指定配置文件，配置文件第一行需要指定版本号。版本号需要和软件大包的版本一致，否则可能会导致设备实际生效的配置与配置文件不一致==
## 配置文件服务器
并在文件服务器工作目录下创建文件`lswnet.cfg`
文件内容如下：
```
esn=xxxx;vrpfile=s57li_easy_V200R022C00.cc;vrpver=V200R022C00SPC100;patchfile=s57li_easy_V200R022C00.pat;cfgfile=s57li_easy_V200R022C00.cfg;
```
## 配置DHCP
```
ip pool easy-operation
 gateway-list x.x.x.
 network x.x.x.0 mask 255.255.255.0
 option 66 ascii sftp://tftpuser:password@192.168.4.6:10020
 option 146 ascii netfile=lswnet.cfg;
```
## 交换机下行口
```
interface GigabitEthernet0/0/2
 port link-type hybrid
 port hybrid pvid vlan 10
 port hybrid untagged vlan 10
```
## 运行`初始化`程序将生成的`cfg`文件存放于`E:\1\`目录
## 将配置文件上传至文件服务器
### 下载pscp.exe
从PuTTY官方网站下载`pscp.exe`，并放到`C:\Windows\System32`目录下
### 运行批处理上传配置文件
```
@echo off
setlocal enabledelayedexpansion

:: 目标服务器信息
set USER=root
set PASSWORD=password
set HOST=10.1.1.1
set PORT=22
set REMOTE_PATH=/home/config/cfg/

:: 本地文件夹
set LOCAL_PATH=E:\1\*

:: 执行 SCP 上传
pscp -P %PORT% -pw %PASSWORD% %LOCAL_PATH% %USER%@%HOST%:%REMOTE_PATH%

echo 上传完成！
pause
```

## 监控`cfg`目录并运行更新`lswnet.cfg`脚本
### 安装`inotifywait`
### 后台运行
```
nohup /home/hw_config/watch_cfg.sh >/dev/null 2>&1 &
```
### 监控cfg脚本

```sh
#!/bin/bash

WATCH_DIR="/home/config/cfg"
SCRIPT="/home/config/auto.sh"

inotifywait -m -r -e modify,create,delete,move "$WATCH_DIR" | while read path action file; do
    echo "$(date) - 检测到 $action: $file" >> /home/config/monitor.log
    bash "$SCRIPT"
done
```
### 更新lswnet.cfg脚本
配置文件名格式为`esn_ip.cfg`
脚本名`auto.sh`
```
```sh
#!/bin/bash

# 源文件所在目录
source_dir="/home/config/cfg"

# 目标文件 lswnet.cfg
target_file="/home/config/lswnet.cfg"

# 临时存储所有行的数组
declare -a lines

# 遍历源目录下所有的 *_*.cfg 文件
for file in "$source_dir"/*_*.cfg; do
  # 提取文件名中的前缀（xxxx）和 IP 地址（10.1.1.1）
  base_name=$(basename "$file" .cfg)
  name_prefix=$(echo "$base_name" | sed -E 's/([a-zA-Z0-9]+)_([0-9]+\.[0-9]+\.[0-9]+\.[0-9]+)$/\1/')

  # 生成新的行内容并存入数组
  lines+=("esn=$name_prefix;cfgfile=cfg/$base_name.cfg")
done

# 统一写入 lswnet.cfg
printf "%s\n" "${lines[@]}" > "$target_file"
```
