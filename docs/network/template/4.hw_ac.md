## Master
==9700M1==
### 配置VRRP双机热备份
配置VRRP备份组的状态恢复延迟时间为60s
``` cfg
vrrp recover-delay 60
```
创建管理VRRP备份组，优先级120，抢占时间1800s
``` cfg
interface Vlanif2853
 ip address x.x.x.x 255.255.255.0
 vrrp vrid 1 virtual-ip x.x.x.x
 admin-vrrp vrid 1
 vrrp vrid 1 priority 120
 vrrp vrid 1 preempt-mode timer delay 1800
```
创建HSB主服务0，及主备通道IP地址和端口号
``` cfg
hsb-service 0
 service-ip-port local-ip x.x.x.x peer-ip x.x.x.x local-data-port 10241 peer-data-port 10241
 service-keep-alive detect retransmit 3 interval 6
```
绑定HSB主备服务0和管理VRRP备份组
``` cfg
hsb-group 0
 track vrrp vrid 1 interface Vlanif853
 bind-service 0
 hsb enable
```
配置NAC、DHCP、wlan业务绑定HSB备份组
``` cfg
hsb-service-type access-user hsb-group 0
hsb-service-type dhcp hsb-group 0
hsb-service-type ap hsb-group 0
```

``` cfg
 autosave interval on
 autosave time off
 autosave time 00:00:00
#
 http secure-server ssl-policy default_policy
 http secure-server server-source -i all
 http server enable
#
 clock timezone BJ add 08:00:00
#
  set np rss hash-mode 5-tuple
#
radius-attribute nas-ip x.x.x.x
#
mdns permit service-type _airplay._tcp.local id 0
mdns permit service-type _raop._tcp.local id 1
mdns permit service-type _printer._tcp.local id 2
mdns permit service-type _ipp._tcp.local id 3
mdns permit service-type _universal._sub._ipp._tcp.local id 4
mdns permit service-type _cups._sub._ipp._tcp.local id 5
#
vlan batch 832 to 833 853 609 400
#
stp mode rstp
stp bpdu-protection
stp enable
#
authentication-profile name default_authen_profile
authentication-profile name dot1x_authen_profile
authentication-profile name mac_authen_profile
authentication-profile name macportal_authen_profile
authentication-profile name portal_authen_profile
authentication-profile name qwe
 dot1x-access-profile qwe
 access-domain qwe force
authentication-profile name webCreate_1
 radius-server qwe
#
domain qwe
#
dns resolve 
dns proxy enable
#
vlan pool 1
 vlan 832 to 833
#
dhcp enable
#
management-port isolate enable
management-plane isolate enable
#
diffserv domain default
#
radius-server template default
radius-server template qwe
 radius-server shared-key cipher %^%#LF@=!,.ypU_yK@SGq,VF'|>O-qM>#&\T~F:pq9h(%^%#
 radius-server authentication x.x.x.x 1812 weight 100
 radius-server authentication x.x.x.x 1812 weight 80
 radius-server accounting x.x.x.x 1813 weight 100
 radius-server accounting x.x.x.x 1813 weight 80
#
pki realm default
 certificate-check none
#
ssl policy default_policy type server
 pki-realm default
 version tls1.2 
 ciphersuite ecdhe_rsa_aes128_gcm_sha256 ecdhe_rsa_aes256_gcm_sha384 
#
ike proposal default
 encryption-algorithm aes-256 
 dh group14 
 authentication-algorithm sha2-256 
 authentication-method pre-share
 integrity-algorithm hmac-sha2-256 
 prf hmac-sha2-256 
#
free-rule-template name default_free_rule
#
portal-access-profile name portal_access_profile
#
aaa
 authentication-scheme default
  authentication-mode local
 authentication-scheme qwe
  authentication-mode radius
 authentication-scheme radius
  authentication-mode radius
 authentication-scheme webCreate_1
  authentication-mode radius
 authorization-scheme default
  authorization-mode local
 accounting-scheme default
  accounting-mode none
 accounting-scheme qwe
  accounting-mode radius
 local-aaa-user password policy administrator
  password history record number 0
  undo password alert original 
  password expire 0
 domain default
  authentication-scheme default
  accounting-scheme default
  radius-server default
 domain default_admin
  authentication-scheme default
  accounting-scheme default
 domain qwe
  authentication-scheme qwe
  accounting-scheme qwe
  radius-server qwe
 local-user linshi password irreversible-cipher $1a$2:-f@rU%w4$}|g&Q*o0VLV^:,0'SBxX%>iCK>LfeSCY@EKX\o@,$
 local-user linshi privilege level 15
 local-user linshi service-type ssh http
#
interface Vlanif1
 ip address dhcp-alloc unicast
#

#
interface Vlanif3609
 ip address x.x.x.x 255.255.255.248
 management-interface
#
interface Vlanif4000
 ip address x.x.x.x 255.255.255.252
#
interface MEth0/0/1
 ip address 169.254.1.1 255.255.255.0
#
interface Eth-Trunk0
 port link-type trunk
 port trunk allow-pass vlan 2853 3609
#
interface Eth-Trunk1
 port link-type trunk
 undo port trunk allow-pass vlan 1
 port trunk allow-pass vlan 400
 stp disable
#
interface Ethernet0/0/47
 ip address 169.254.3.1 255.255.255.0
#
interface GigabitEthernet0/0/1
 eth-trunk 1
#
interface GigabitEthernet0/0/2
 eth-trunk 1
#
interface GigabitEthernet0/0/3
#
interface GigabitEthernet0/0/4
#
interface GigabitEthernet0/0/5
#
interface GigabitEthernet0/0/6
#
interface GigabitEthernet0/0/7
#
interface GigabitEthernet0/0/8
#
interface GigabitEthernet0/0/9
#
interface GigabitEthernet0/0/10
#               
interface GigabitEthernet0/0/11
#
interface GigabitEthernet0/0/12
 port link-type access
 port default vlan 609
#
interface XGigabitEthernet0/0/5
#
interface XGigabitEthernet0/0/6
#
interface XGigabitEthernet0/0/7
#
interface XGigabitEthernet0/0/8
#
interface XGigabitEthernet0/0/9
#
interface XGigabitEthernet0/0/10
#
interface XGigabitEthernet0/0/11
 eth-trunk 0
#
interface XGigabitEthernet0/0/12
 eth-trunk 0
#
interface 40GE0/0/1
#
interface 40GE0/0/2
#
interface NULL0
#
 ftp server-source -i MEth0/0/1
#
 info-center timestamp log date precision-time millisecond
 info-center timestamp trap date precision-time millisecond
#
undo icmp name timestamp-request receive
#
 snmp-agent local-engineid 800007DB03205383444BDA
 snmp-agent community read @+LXB\V$>Wy/X!kU>6>W\30~pZ2iA4u<&K)[4%^%# 
 snmp-agent sys-info version v2c v3
 snmp-agent trap enable
 snmp-agent trap queue-size 500
 snmp-agent trap life 600
 snmp-agent protocol source-interface all
 snmp-agent 
#
 ssh server timeout 120
 ssh server-source -i all
 stelnet server enable 
 undo telnet server enable 
 undo telnet ipv6 server enable 
 telnet server-source -i MEth0/0/1
ssh server secure-algorithms cipher aes256_ctr aes128_ctr
ssh server secure-algorithms hmac sha2_256
ssh server key-exchange dh_group16_sha512 dh_group15_sha512 ecdh-sha2-nistp521 ecdh-sha2-nistp384 ecdh-sha2-nistp256 dh_group_exchange_sha256
ssh client secure-algorithms cipher aes256_ctr aes128_ctr
ssh client secure-algorithms hmac sha2_256
ssh client key-exchange dh_group16_sha512 dh_group15_sha512 ecdh-sha2-nistp521 ecdh-sha2-nistp384 ecdh-sha2-nistp256 dh_group_exchange_sha256
#
ip route-static 0.0.0.0 0.0.0.0 10.167.253.1
#               
capwap source ip-address x.x.x.x
capwap dtls psk 8,z5SS@DLKG-Y4S</Nl%%%^%#
capwap dtls inter-controller psk %:B(3|V]Tl^L.XPPAuGs.<%^%#
#
user-interface con 0
 authentication-mode password
 set authentication password irreversible-cipher $1b$We]6VzkAm:C])@Y1hIa!$
user-interface vty 0
 authentication-mode aaa
 user privilege level 15
 screen-length 61
 protocol inbound ssh
user-interface vty 1 4
 authentication-mode aaa
 user privilege level 15
 protocol inbound ssh
user-interface vty 16 20
 authentication-mode aaa
 protocol inbound ssh
#
wmi-server
#
wmi-server2
#
wlan
 calibrate enable schedule time 03:00:00
 temporary-management psk %^%#e_4(VnB#5a!nQ7BXE%^%#
 ap username admi password cipher %^%gJ{>M&`~7!J#3+m'%>O)99r.*0#x.%^%#
 traffic-profile name linshi
  traffic-optimize broadcast-suppression packets 128
  traffic-optimize multicast-suppression packets 5
  traffic-optimize unicast-suppression packets 128
 traffic-profile name default
 security-profile name linshi
  security wpa-wpa2 dot1x aes
 security-profile name default
  security wpa3 dot1x gcmp256
  pmf mandatory
 security-profile name default-wds
 security-profile name default-mesh
 ssid-profile name linshi
  ssid WiFi
 ssid-profile name default
 vap-profile name linshi
  service-vlan vlan-pool 1
  ssid-profile linshi
  security-profile linshi
  traffic-profile linshi
  authentication-profile qwe
 vap-profile name default
 wds-profile name default
 mesh-handover-profile name default
 mesh-profile name default
 regulatory-domain-profile name linshi
  dca-channel 5g bandwidth 40mhz
 regulatory-domain-profile name default
 regulatory-domain-profile name WiFi
  dca-channel 5g bandwidth 40mhz
 air-scan-profile name default
 rrm-profile name linshi
  airtime-fair-schedule enable
  band-steer balance start-threshold 30
  sta-load-balance dynamic disable
 rrm-profile name default
 rrm-profile name WiFi
  airtime-fair-schedule enable
  band-steer balance start-threshold 30
  sta-load-balance dynamic disable
 radio-2g-profile name default
 radio-2g-profile name huawei-2.4
  beacon-interval 160
  multicast-rate 54
  wmm edca-ap ac-be aifsn 3 ecw ecwmin 5 ecwmax 6 txoplimit 0 ack-policy normal
 radio-2g-profile name linshi-2.4
  beacon-interval 160
  multicast-rate 54
  wmm edca-ap ac-be aifsn 3 ecw ecwmin 5 ecwmax 6 txoplimit 0 ack-policy normal
 radio-5g-profile name default
 radio-5g-profile name linshi-5
  beacon-interval 160
  multicast-rate 54
  dot11a basic-rate 6 9 12 18 24 36 48 54 
 radio-5g-profile name huawei-5.0
  beacon-interval 160
  multicast-rate 54
  dot11a basic-rate 6 9 12 18 24 36 48 54 
 wids-spoof-profile name default
 wids-whitelist-profile name default
 wids-profile name default
 wireless-access-specification
 tunnel-ap-group name default
 ap-system-profile name default
  telnet enable
  lldp report enable
  traffic-optimize broadcast-suppression other-broadcast disable
  traffic-optimize broadcast-suppression other-multicast disable
  traffic-optimize broadcast-suppression arp rate-threshold 128
  traffic-optimize broadcast-suppression igmp rate-threshold 128
  traffic-optimize broadcast-suppression nd rate-threshold 128
 port-link-profile name default
 wired-port-profile name default
 ap auth-mode no-auth
 ap-group name linshi
  regulatory-domain-profile linshi
  radio 0
   radio-2g-profile linshi-2.4
   vap-profile linshi wlan 1
  radio 1
   radio-5g-profile linshi-5
   vap-profile linshi wlan 1
  radio 2
   vap-profile linshi wlan 1
 ap-group name default
  radio 0
   radio-2g-profile huawei-2.4
  radio 1
   radio-5g-profile huawei-5.0

 provision-ap
 master controller
  master-redundancy track-vrrp vrid 1 interface Vlanif853
  master-redundancy peer-ip ip-address x.x.x.x local-ip ip-address x.x.x.x psk %^%#p+`l1Ok|<**"HI(Sa{Z2XTKX^5xmr+K%^%#
#
device-profile profile-name @default_device_profile
 device-type default_type_phone
 enable
 rule 0 user-agent sub-match Android 
 rule 1 user-agent sub-match iPhone 
 rule 2 user-agent sub-match iPad 
 if-match rule 0 or rule 1 or rule 2
#
dot1x-access-profile name dot1x_access_profile
dot1x-access-profile name qwe
#
mac-access-profile name mac_access_profile
mac-access-profile name qwe
 mac-authen username macaddress format with-hyphen
#
 ntp-service server server-source -i all
 ntp-service unicast-server x.x.x.x
#
return
```
## Slave
### 配置VRRP双机热备份
配置VRRP备份组的状态恢复延迟时间为60s
``` cfg
vrrp recover-delay 60
```
创建管理VRRP备份组
``` cfg
interface Vlanif2853
 ip address x.x.x.x 255.255.255.0
 vrrp vrid 1 virtual-ip x.x.x.x
 admin-vrrp vrid 1
```
创建HSB主服务0，及主备通道IP地址和端口号
``` cfg
hsb-service 0
 service-ip-port local-ip x.x.x.x peer-ip x.x.x.x local-data-port 10241 peer-data-port 10241
 service-keep-alive detect retransmit 3 interval 6
```
绑定HSB主备服务0和管理VRRP备份组
``` cfg
hsb-group 0
 track vrrp vrid 1 interface Vlanif853
 bind-service 0
 hsb enable
```
配置NAC、DHCP、wlan业务绑定HSB备份组
``` cfg
hsb-service-type access-user hsb-group 0
hsb-service-type dhcp hsb-group 0
hsb-service-type ap hsb-group 0
```
``` cfg
 autosave interval on
 autosave time off
 autosave time 00:00:00
#
 http secure-server ssl-policy default_policy
 http secure-server server-source -i all
 http server enable
#
 clock timezone BJ add 08:00:00
#
  set np rss hash-mode 5-tuple
#
radius-attribute nas-ip x.x.x.x
#
mdns permit service-type _airplay._tcp.local id 0
mdns permit service-type _raop._tcp.local id 1
mdns permit service-type _printer._tcp.local id 2
mdns permit service-type _ipp._tcp.local id 3
mdns permit service-type _universal._sub._ipp._tcp.local id 4
mdns permit service-type _cups._sub._ipp._tcp.local id 5
#               
vrrp recover-delay 60
#
vlan batch 853 609 400
#
stp mode rstp
stp bpdu-protection
stp enable
#
authentication-profile name default_authen_profile
authentication-profile name dot1x_authen_profile
authentication-profile name mac_authen_profile
authentication-profile name macportal_authen_profile
authentication-profile name portal_authen_profile
authentication-profile name qwe
 dot1x-access-profile qwe
 access-domain qwe force
authentication-profile name webCreate_1
 radius-server qwe
#
domain qwe
#
dns resolve 
dns proxy enable
#               
vlan pool 1
 vlan 832 to 833
#
dhcp enable
#
diffserv domain default
#
radius-server template default
radius-server template qwe
 radius-server shared-key cipher %^%|>O-qM>#&\T~F:pq9h(%^%#
 radius-server authentication x.x.x.x 1812 weight 100
 radius-server authentication x.x.x.x 1812 weight 80
 radius-server accounting x.x.x.x 1813 weight 100
 radius-server accounting x.x.x.x 1813 weight 80
#
pki realm default
 certificate-check none
#
ssl policy default_policy type server
 pki-realm default
 version tls1.2 
 ciphersuite ecdhe_rsa_aes128_gcm_sha256 ecdhe_rsa_aes256_gcm_sha384 
#
ike proposal default
 encryption-algorithm aes-256 
 dh group14 
 authentication-algorithm sha2-256 
 authentication-method pre-share
 integrity-algorithm hmac-sha2-256 
 prf hmac-sha2-256 
#
free-rule-template name default_free_rule
#
portal-access-profile name portal_access_profile
#
aaa
 authentication-scheme default
  authentication-mode local
 authentication-scheme qwe
  authentication-mode radius
 authentication-scheme radius
  authentication-mode radius
 authentication-scheme webCreate_1
  authentication-mode radius
 authorization-scheme default
  authorization-mode local
 accounting-scheme default
  accounting-mode none
 accounting-scheme qwe
  accounting-mode radius
 domain default
  authentication-scheme default
  accounting-scheme default
  radius-server default
 domain default_admin
  authentication-scheme default
  accounting-scheme default
 domain qwe
  authentication-scheme qwe
  accounting-scheme qwe
  radius-server qwe
 local-user linshi password irreversible-cipher $@|I-;RgLzbv*X~5%~J$
 local-user linshi privilege level 15
 local-user linshi service-type ssh http
#
interface Vlanif1
 ip address dhcp-alloc unicast
#
interface Vlanif609
 ip address x.x.x.x 255.255.255.248
 management-interface
#
interface Vlanif400
 ip address x.x.x.x 255.255.255.252
#
interface MEth0/0/1
#
interface Eth-Trunk0
 port link-type trunk
 port trunk allow-pass vlan 853 609
#
interface Eth-Trunk1
 port link-type trunk
 undo port trunk allow-pass vlan 1
 port trunk allow-pass vlan 400
 stp disable
#
interface Ethernet0/0/47
 ip address 169.254.3.1 255.255.255.0
#
interface GigabitEthernet0/0/1
 eth-trunk 1
#
interface GigabitEthernet0/0/2
 eth-trunk 1
#
interface GigabitEthernet0/0/3
#
interface GigabitEthernet0/0/4
#
interface GigabitEthernet0/0/5
#
interface GigabitEthernet0/0/6
#
interface GigabitEthernet0/0/7
#               
interface GigabitEthernet0/0/8
#
interface GigabitEthernet0/0/9
#
interface GigabitEthernet0/0/10
#
interface GigabitEthernet0/0/11
#
interface GigabitEthernet0/0/12
#
interface XGigabitEthernet0/0/5
#
interface XGigabitEthernet0/0/6
#
interface XGigabitEthernet0/0/7
#
interface XGigabitEthernet0/0/8
#
interface XGigabitEthernet0/0/9
#
interface XGigabitEthernet0/0/10
#
interface XGigabitEthernet0/0/11
 eth-trunk 0
#
interface XGigabitEthernet0/0/12
 eth-trunk 0
#
interface 40GE0/0/1
#
interface 40GE0/0/2
#
interface NULL0
#
interface LoopBack0
#
 ftp server-source -i MEth0/0/1
#
 info-center timestamp log date precision-time millisecond
 info-center timestamp trap date precision-time millisecond
#
undo icmp name timestamp-request receive
#               
 undo snmp-agent 
#
 ssh server-source -i all
 ssh client first-time enable 
 stelnet server enable 
 undo telnet server enable 
 undo telnet ipv6 server enable 
ssh server secure-algorithms cipher aes256_ctr aes128_ctr
ssh server secure-algorithms hmac sha2_256
ssh server key-exchange dh_group16_sha512 dh_group15_sha512 ecdh-sha2-nistp521 ecdh-sha2-nistp384 ecdh-sha2-nistp256 dh_group_exchange_sha256
ssh client secure-algorithms cipher aes256_ctr aes128_ctr
ssh client secure-algorithms hmac sha2_256
ssh client key-exchange dh_group16_sha512 dh_group15_sha512 ecdh-sha2-nistp521 ecdh-sha2-nistp384 ecdh-sha2-nistp256 dh_group_exchange_sha256
#
ip route-static 0.0.0.0 0.0.0.0 x.x.x.x
#
capwap source ip-address x.x.x.x
capwap dtls psk %^%#]qGGR3T]+1VSQ`6U8GANl%%%^%#
capwap dtls inter-controller psk %^%#'[n`U0n=9DFC_hQ~y>.EWS%@,%^%#
#
user-interface con 0
 authentication-mode password
 set authentication password irreversible-cipher $1b$SAI9LANjj/I.BA-wZuFX7n'p4[$At"]QVmF$
user-interface vty 0 4
 authentication-mode aaa
 protocol inbound ssh
user-interface vty 16 20
 authentication-mode aaa
 protocol inbound ssh
#
wmi-server
#
wmi-server2
#
wlan
 calibrate enable schedule time 03:00:00
 temporary-management psk %^%#e_4(Vj0j]8:B#5a!n$G2[Q%)Q7BXE%^%#
 ap username cweyw_3 password cipher %^%#lgHSR3+m'%>O)99r.*0#x.%^%#
 traffic-profile name linshi
  traffic-optimize broadcast-suppression packets 128
  traffic-optimize multicast-suppression packets 5
  traffic-optimize unicast-suppression packets 128
 traffic-profile name default
 security-profile name linshi
  security wpa-wpa2 dot1x aes
 security-profile name default
  security wpa3 dot1x gcmp256
  pmf mandatory
 security-profile name default-wds
 security-profile name default-mesh
 ssid-profile name linshi
  ssid WiFi
 ssid-profile name default
 vap-profile name linshi
  service-vlan vlan-pool 1
  ssid-profile linshi
  security-profile linshi
  traffic-profile linshi
  authentication-profile qwe
 vap-profile name default
 wds-profile name default
 mesh-handover-profile name default
 mesh-profile name default
 regulatory-domain-profile name linshi
  dca-channel 5g bandwidth 40mhz
 regulatory-domain-profile name default
 regulatory-domain-profile name WiFi
  dca-channel 5g bandwidth 40mhz
 air-scan-profile name default
 rrm-profile name linshi
  airtime-fair-schedule enable
  band-steer balance start-threshold 30
  sta-load-balance dynamic disable
 rrm-profile name default
 rrm-profile name WiFi
  airtime-fair-schedule enable
  band-steer balance start-threshold 30
  sta-load-balance dynamic disable
 radio-2g-profile name default
 radio-2g-profile name huawei-2.4
  beacon-interval 160
  multicast-rate 54
  wmm edca-ap ac-be aifsn 3 ecw ecwmin 5 ecwmax 6 txoplimit 0 ack-policy normal
 radio-2g-profile name linshi-2.4
  beacon-interval 160
  multicast-rate 54
  wmm edca-ap ac-be aifsn 3 ecw ecwmin 5 ecwmax 6 txoplimit 0 ack-policy normal
 radio-5g-profile name default
 radio-5g-profile name linshi-5
  beacon-interval 160
  multicast-rate 54
  dot11a basic-rate 6 9 12 18 24 36 48 54 
 radio-5g-profile name huawei-5.0
  beacon-interval 160
  multicast-rate 54
  dot11a basic-rate 6 9 12 18 24 36 48 54 
 wids-spoof-profile name default
 wids-whitelist-profile name default
 wids-profile name default
 wireless-access-specification
 tunnel-ap-group name default
 ap-system-profile name default
  telnet enable
  lldp report enable
  traffic-optimize broadcast-suppression other-broadcast disable
  traffic-optimize broadcast-suppression other-multicast disable
  traffic-optimize broadcast-suppression arp rate-threshold 128
  traffic-optimize broadcast-suppression igmp rate-threshold 128
  traffic-optimize broadcast-suppression nd rate-threshold 128
 port-link-profile name default
 wired-port-profile name default
 ap auth-mode no-auth
 ap-group name linshi
  regulatory-domain-profile linshi
  radio 0
   radio-2g-profile linshi-2.4
   vap-profile linshi wlan 1
  radio 1
   radio-5g-profile linshi-5
   vap-profile linshi wlan 1
  radio 2
   vap-profile linshi wlan 1
 ap-group name default
  radio 0
   radio-2g-profile huawei-2.4
  radio 1
   radio-5g-profile huawei-5.0
 ap-id 0 type-id 151 ap-mac 609b-b4f1-c3f0 ap-sn 2102354VQH6RQ4002190
  ap-name CW-DC
  ap-group linshi
 provision-ap
 master controller
  master-redundancy track-vrrp vrid 1 interface Vlanif2853
  master-redundancy peer-ip ip-address 172.30.254.1 local-ip ip-address 172.30.254.2 psk %^%#m3|w&Z#O*FCd!\"[9PT5z(-dNGX2o7-,FK<XC.xD%^%#
#
device-profile profile-name @default_device_profile
 device-type default_type_phone
 enable
 rule 0 user-agent sub-match Android 
 rule 1 user-agent sub-match iPhone 
 rule 2 user-agent sub-match iPad 
 if-match rule 0 or rule 1 or rule 2
#
dot1x-access-profile name dot1x_access_profile
dot1x-access-profile name qwe
#
mac-access-profile name mac_access_profile
mac-access-profile name qwe
 mac-authen username macaddress format with-hyphen
#
 ntp-service server server-source -i Vlanif609
 ntp-service unicast-server x.x.x.x
#
return

```
