---
title: sto
permalink: /stp/
---
## 选路原则

# 生成树
## 生成树选举

| 生成树 | 描述    | 收敛时间 | 端口状态                            |
|--------|---------|----------|-----------------------------------|
| STP    | 802.1D，所有VLAN一个实例  |          | 阻塞、侦听、学习、转发、禁用      |
| RSTP   | 802.1W，STP进化版，收敛时间短  |          | 丢弃、学习、转发                  |
| MSTP   | 802.1S  |          |                                   |

- 选举根桥：
根据BPDU报文中的BID选举根桥。BID为优先级+最小的mac地址，越小越优先。
- 选择根端口：
在每一个非根桥的交换机上选举一个端口，该端口到根桥的代价是最小的，该端口称为根端口。
1）比较每个端口到根桥的cost值的累加和，越小越优先。10M=cost为100，100M=cost为19，1000M=cost为4，10000M=cost为2。
2）cost值无法比较出来，那么就比较上连交换机的BID。
3）上连交换机的BID无法比较出来，那么就比较对端的port-ID，port-ID为优先级＋端口编号，128+端口编号（如f/1）
4）对端的port-ID无法比较出来，那么就比较自己这段的port-ID。
- 选择指定端口：
在每一条链路上选择一个指定端口。
1）比较链路两端各自到根桥的cost的累加和，越小越优先。或者比较根端口到根桥的cost值。越小越优先。
2）比较两端交换机的BID。
3）比较两端端口的port-ID。
4）将既不是指定端口又不是根端口的端口阻塞掉（阻塞端口）
